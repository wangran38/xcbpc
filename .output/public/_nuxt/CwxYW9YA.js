import{_ as k,t as l,z as p,x as s,H as d,y as n,I as m,J as h,bJ as g,K as _,L as I,B as v,bG as w,bK as P,g as f,v as a}from"./DCPh1BYy.js";import{g as S,d as T,s as F}from"./3EPULsr-.js";import{f as L,h as q}from"./D82-cQi9.js";const G={components:{headerVue:q,footerVue:L},data(){return{shopId:null,shopInfo:{id:"",title:"",businesslogo:"",banner:"",rating:4.5,commentCount:126,goodCommentRate:96,tags:[],description:"",businessHours:"08:00-21:00",phone:"",market_address:"",deliveryRange:"3å…¬é‡Œå†…",deliveryFee:5,minOrderAmount:20,qualifications:[]},query:{page:1,limit:10,isshow:1},loadLock:!1,scrollLock:!0,isCollected:!1,activeTab:"goods",goodsCategories:[],allGoods:[],selectedCategory:0,goodsSearch:"",allComments:[],commentFilter:"all",currentCommentPage:1,commentsPerPage:10,cartItems:[]}},computed:{filteredGoods(){return this.allGoods.filter(e=>{const t=this.selectedCategory===0||e.categoryId===this.selectedCategory,c=!this.goodsSearch||e.name.toLowerCase().includes(this.goodsSearch.toLowerCase())||e.description.toLowerCase().includes(this.goodsSearch.toLowerCase());return t&&c})},filteredComments(){let e=[...this.allComments];this.commentFilter==="good"?e=e.filter(c=>c.rating>=4):this.commentFilter==="medium"?e=e.filter(c=>c.rating===3):this.commentFilter==="bad"&&(e=e.filter(c=>c.rating<=2));const t=(this.currentCommentPage-1)*this.commentsPerPage;return e.slice(t,t+this.commentsPerPage)},totalCommentPages(){let e=this.allComments.length;return this.commentFilter==="good"?e=this.allComments.filter(t=>t.rating>=4).length:this.commentFilter==="medium"?e=this.allComments.filter(t=>t.rating===3).length:this.commentFilter==="bad"&&(e=this.allComments.filter(t=>t.rating<=2).length),Math.ceil(e/this.commentsPerPage)},cartTotalCount(){return this.cartItems.reduce((e,t)=>e+t.quantity,0)},cartTotalPrice(){const e=this.cartItems.reduce((t,c)=>t+c.price*c.quantity,0);return e+(e>=this.shopInfo.minOrderAmount?0:this.shopInfo.deliveryFee)}},async mounted(){this.shopId=parseInt((this._.provides[P]||this.$route).query.id),await this.loadShopDetail(),await this.loadShopGoods(),window.addEventListener("scroll",async()=>{window.innerHeight+window.pageYOffset>=document.body.offsetHeight-200&&this.scrollLock&&(this.scrollLock=!1,this.query.page++,await this.loadShopGoods(),this.scrollLock=!0)})},methods:{async loadShopDetail(){try{const e=await F({id:this.shopId});e.code===200&&(this.shopInfo=e.data.listdata[0])}catch(e){console.error("Failed to load shop detail:",e)}},async loadShopGoods(){if(!this.loadLock)try{this.query.shop_id=this.shopId;const e=await T(this.query);e.code===200&&(this.goodsCategories=e.data.categories||[],this.allGoods=[...this.allGoods,...e.data.listdata],this.loadLock=e.data.listdata.length<=0)}catch(e){console.error("Failed to load shop goods:",e)}},async loadShopComments(){try{const e=await S(this.shopId);e.code===200&&(this.allComments=e.data||[])}catch(e){console.error("Failed to load shop comments:",e)}},toggleCollect(){this.isCollected=!this.isCollected},filterComments(){this.currentCommentPage=1},changeCommentPage(e){this.currentCommentPage+=e},formatDate(e){const t=new Date(e);return`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")}`},addToCart(e){const t=this.cartItems.find(c=>c.id===e.id);t?t.quantity++:this.cartItems.push({...e,quantity:1})},goToCheckout(){this.$router.push({path:"/checkout",query:{shopId:this.shopId},state:{cartItems:this.cartItems}})}},watch:{}},V={class:"shop-detail-page"},x={class:"shop-header"},D={class:"shop-base-info"},M={class:"container"},H={class:"shop-logo"},N=["data-src","src","alt"],z={class:"shop-main-info"},B={class:"shop-title"},E={class:"shop-rating"},R={class:"rating-stars"},A={class:"shop-nav"},O={class:"container"},J={class:"nav-tabs"},K={key:0,class:"goods-list"},U={class:"container"},Y={class:"goods-filter"},j={class:"filter-scroll"},Q={class:"search-box"},W={class:"goods-grid"},X={class:"goods-image"},Z=["src","data-src","alt"],$={key:0,class:"goods-tag"},ss={class:"goods-info"},ts={class:"goods-name"},es={class:"goods-desc"},os={class:"goods-price"},is={class:"price"},ns={key:0,class:"original-price"},ls={key:0,class:"no-goods"},as={key:1,class:"shop-details"},rs={class:"container"},cs={class:"detail-section"},ds={class:"shop-description"},ms={class:"detail-section"},hs={class:"business-hours"},us={class:"detail-section"},gs={class:"contact-info"},vs={class:"detail-section"},ps={class:"qualifications"},_s=["src"],fs={key:2,class:"shop-comments"},Cs={class:"container"},ys={class:"comments-stats"},bs={class:"stat-item"},ks={class:"stat-value"},Is={class:"stat-item"},ws={class:"stat-value"},Ps={class:"comments-filter"},Ss={class:"comments-list"},Ts={class:"comment-header"},Fs={class:"user-avatar"},Ls=["src"],qs={class:"user-info"},Gs={class:"user-name"},Vs={class:"comment-time"},xs={class:"comment-rating"},Ds={class:"comment-content"},Ms={key:0,class:"comment-images"},Hs=["src","alt"],Ns={key:1,class:"comment-reply"},zs={class:"reply-content"},Bs={key:0,class:"no-comments"},Es={key:1,class:"pagination"},Rs=["disabled"],As=["disabled"],Os={key:3,class:"cart-float"},Js={class:"cart-count"};function Ks(e,t,c,Us,i,r){const C=f("headerVue"),y=f("footerVue");return a(),l("div",V,[p(C),s("section",x,[s("div",D,[s("div",M,[s("div",H,[s("img",{"data-src":i.shopInfo.logo,src:i.shopInfo.logo,alt:i.shopInfo.title,loading:"lazy"},null,8,N)]),s("div",z,[s("h1",B,n(i.shopInfo.title),1),s("div",E,[s("div",R,[(a(),l(m,null,h(5,o=>s("span",{class:"star active",key:o},"â˜…")),64))]),t[10]||(t[10]=s("span",{class:"rating-score"},n(5)+"â˜…",-1)),t[11]||(t[11]=s("span",{class:"rating-count"},"("+n(1111)+"æ¡è¯„ä»·)",-1))])]),t[12]||(t[12]=s("div",{class:"shop-actions"},[s("button",{class:"contact-btn"},"è”ç³»å•†å®¶")],-1))])])]),s("section",A,[s("div",O,[s("div",J,[s("div",{class:g(["tab-item",{active:i.activeTab==="goods"}]),onClick:t[0]||(t[0]=o=>i.activeTab="goods")}," å•†å“åˆ—è¡¨ ",2),s("div",{class:g(["tab-item",{active:i.activeTab==="info"}]),onClick:t[1]||(t[1]=o=>i.activeTab="info")}," åº—é“ºä¿¡æ¯ ",2),s("div",{class:g(["tab-item",{active:i.activeTab==="comments"}]),onClick:t[2]||(t[2]=o=>i.activeTab="comments")}," é¡¾å®¢è¯„ä»· ",2)])])]),i.activeTab==="goods"?(a(),l("section",K,[s("div",U,[s("div",Y,[s("div",j,[s("div",{class:g(["filter-item",{active:i.selectedCategory===0}]),onClick:t[3]||(t[3]=o=>i.selectedCategory=0)}," å…¨éƒ¨å•†å“ ",2)]),s("div",Q,[_(s("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=o=>i.goodsSearch=o),placeholder:"æœç´¢å•†å“"},null,512),[[I,i.goodsSearch]]),t[13]||(t[13]=s("button",{class:"search-btn"},"ðŸ”",-1))])]),s("div",W,[(a(!0),l(m,null,h(r.filteredGoods,o=>(a(),l("div",{class:"goods-card",key:o.id},[s("div",X,[s("img",{src:o.imglogo,"data-src":o.imglogo,alt:o.commodity_name,loading:"lazy"},null,8,Z),o.promotion?(a(),l("div",$,n(o.promotion),1)):d("",!0)]),s("div",ss,[s("h3",ts,n(o.commodity_name),1),s("p",es,n(o.weight_name),1),s("div",os,[s("span",is,"Â¥"+n(o.price),1),o.price?(a(),l("span",ns,"Â¥"+n(o.price*2),1)):d("",!0)])])]))),128))]),r.filteredGoods.length===0?(a(),l("div",ls,t[14]||(t[14]=[s("p",null,"æš‚æ— ç›¸å…³å•†å“",-1)]))):d("",!0)])])):d("",!0),i.activeTab==="info"?(a(),l("section",as,[s("div",rs,[s("div",cs,[t[15]||(t[15]=s("h2",{class:"section-title"},"åº—é“ºä»‹ç»",-1)),s("div",ds,n(i.shopInfo.description),1)]),s("div",ms,[t[16]||(t[16]=s("h2",{class:"section-title"},"è¥ä¸šæ—¶é—´",-1)),s("div",hs,[s("p",null,n(i.shopInfo.businessHours),1)])]),s("div",us,[t[19]||(t[19]=s("h2",{class:"section-title"},"è”ç³»æ–¹å¼",-1)),s("div",gs,[s("p",null,[t[17]||(t[17]=s("i",{class:"phone-icon"},null,-1)),v(" "+n(i.shopInfo.phone),1)]),s("p",null,[t[18]||(t[18]=s("i",{class:"location-icon"},null,-1)),v(" "+n(i.shopInfo.market_address),1)])])]),t[21]||(t[21]=s("div",{class:"detail-section"},[s("h2",{class:"section-title"},"é…é€ä¿¡æ¯"),s("div",{class:"delivery-info"},[s("p",null,"é…é€èŒƒå›´ï¼š"+n("5kg")),s("p",null,"é…é€è´¹ï¼š"+n("å…è´¹")),s("p",null,"èµ·é€ä»·ï¼šÂ¥"+n(50))])],-1)),s("div",vs,[t[20]||(t[20]=s("h2",{class:"section-title"},"åº—é“ºèµ„è´¨",-1)),s("div",ps,[(a(!0),l(m,null,h(i.shopInfo.qualifications,(o,u)=>(a(),l("div",{class:"qualification-item",key:u},[s("img",{src:o,alt:"èµ„è´¨è¯æ˜Ž"},null,8,_s)]))),128))])])])])):d("",!0),i.activeTab==="comments"?(a(),l("section",fs,[s("div",Cs,[s("div",ys,[t[24]||(t[24]=s("div",{class:"stat-item"},[s("div",{class:"stat-value"},n(5)),s("div",{class:"stat-label"},"ç»¼åˆè¯„åˆ†")],-1)),s("div",bs,[s("div",ks,n(i.shopInfo.goodCommentRate)+"%",1),t[22]||(t[22]=s("div",{class:"stat-label"},"å¥½è¯„çŽ‡",-1))]),s("div",Is,[s("div",ws,n(i.shopInfo.commentCount),1),t[23]||(t[23]=s("div",{class:"stat-label"},"è¯„ä»·æ•°é‡",-1))])]),s("div",Ps,[_(s("select",{"onUpdate:modelValue":t[5]||(t[5]=o=>i.commentFilter=o),onChange:t[6]||(t[6]=(...o)=>r.filterComments&&r.filterComments(...o))},t[25]||(t[25]=[s("option",{value:"all"},"å…¨éƒ¨è¯„ä»·",-1),s("option",{value:"good"},"å¥½è¯„",-1),s("option",{value:"medium"},"ä¸­è¯„",-1),s("option",{value:"bad"},"å·®è¯„",-1)]),544),[[w,i.commentFilter]])]),s("div",Ss,[(a(!0),l(m,null,h(r.filteredComments,o=>(a(),l("div",{class:"comment-item",key:o.id},[s("div",Ts,[s("div",Fs,[s("img",{src:o.userAvatar,alt:"ç”¨æˆ·å¤´åƒ"},null,8,Ls)]),s("div",qs,[s("div",Gs,n(o.userName),1),s("div",Vs,n(r.formatDate(o.createTime)),1)]),s("div",xs,[(a(),l(m,null,h(5,u=>s("span",{class:g(["star",{active:e.active}]),key:u},"â˜…",2)),64))])]),s("div",Ds,n(o.content),1),o.images.length>0?(a(),l("div",Ms,[(a(!0),l(m,null,h(o.images,(u,b)=>(a(),l("img",{src:u,alt:e.è¯„è®ºå›¾ç‰‡,key:b},null,8,Hs))),128))])):d("",!0),o.reply?(a(),l("div",Ns,[t[26]||(t[26]=s("div",{class:"reply-label"},"å•†å®¶å›žå¤ï¼š",-1)),s("div",zs,n(o.reply),1)])):d("",!0)]))),128))]),r.filteredComments.length===0?(a(),l("div",Bs,t[27]||(t[27]=[s("p",null,"æš‚æ— è¯„ä»·",-1)]))):d("",!0),r.filteredComments.length>0?(a(),l("div",Es,[s("button",{class:"page-btn prev",onClick:t[7]||(t[7]=o=>r.changeCommentPage(-1)),disabled:i.currentCommentPage===1}," ä¸Šä¸€é¡µ ",8,Rs),s("button",{class:"page-btn next",onClick:t[8]||(t[8]=o=>r.changeCommentPage(1)),disabled:i.currentCommentPage>=r.totalCommentPages}," ä¸‹ä¸€é¡µ ",8,As)])):d("",!0)])])):d("",!0),i.cartItems.length>0?(a(),l("div",Os,[s("div",Js,n(r.cartTotalCount),1),t[28]||(t[28]=s("div",{class:"cart-info"},[s("div",{class:"cart-total"},[v(" åˆè®¡ï¼š"),s("span",{class:"total-price"},"Â¥"+n(111))]),s("div",{class:"cart-desc"},"å·²å«é…é€è´¹")],-1)),s("button",{class:"checkout-btn",onClick:t[9]||(t[9]=(...o)=>r.goToCheckout&&r.goToCheckout(...o))},"åŽ»ç»“ç®—")])):d("",!0),p(y)])}const Ws=k(G,[["render",Ks]]);export{Ws as default};
